<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <title>Gestion Financière - Argon Dashboard</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <!-- Fonts et icônes -->
    <link
      href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700"
      rel="stylesheet"
    />
    <link
      href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-icons.css"
      rel="stylesheet"
    />
    <link
      href="https://demos.creative-tim.com/argon-dashboard-pro/assets/css/nucleo-svg.css"
      rel="stylesheet"
    />
    <script
      src="https://kit.fontawesome.com/42d5adcbca.js"
      crossorigin="anonymous"
    ></script>

    <!-- CSS principal -->
    <link
      id="pagestyle"
      href="../assets/css/argon-dashboard.css?v=2.1.0"
      rel="stylesheet"
    />
    <style>
      #encaissementsTable th {
        background-color: #5e72e4;
        color: white;
      }
      #encaissementsTable td {
        vertical-align: middle;
      }
      .form-popup {
        display: none;
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 9999;
      }
      .form-group {
        margin-bottom: 1rem;
      }
      .section-content {
        display: none;
      }
      .section-active {
        display: block;
      }
    </style>
  </head>
  <body class="g-sidenav-show bg-gray-100">
    <div class="min-height-300 bg-dark position-absolute w-100"></div>

    <!-- Sidebar -->
    <aside
      class="sidenav bg-white navbar navbar-vertical navbar-expand-xs border-0 border-radius-xl my-3 fixed-start ms-4"
      id="sidenav-main"
    >
      <div class="sidenav-header">
        <h4 class="text-dark text-center py-3">Tableau de Bord</h4>
      </div>
      <hr class="horizontal dark mt-0" />
      <div class="collapse navbar-collapse w-auto" id="sidenav-collapse-main">
        <ul class="navbar-nav">
          <li class="nav-item">
            <a class="nav-link" href="#" onclick="switchSection('dashboard')">
              <i class="fas fa-chart-line text-primary"></i>
              <span class="nav-link-text ms-2">Dashboard</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link active"
              href="Encaissements.html"
              onclick="switchSection('encaissements')"
            >
              <i class="fas fa-file-invoice-dollar text-success"></i>
              <span class="nav-link-text ms-2">Encaissements</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="Decaissements.html"
              onclick="switchSection('decaissements')"
            >
              <i class="fas fa-users text-warning"></i>
              <span class="nav-link-text ms-2">Decaissements</span>
            </a>
          </li>
          <li class="nav-item">
            <a
              class="nav-link"
              href="TresorerieFinale.html"
              onclick="switchSection('tresorerie')"
            >
              <i class="fas fa-cogs text-info"></i>
              <span class="nav-link-text ms-2">Tresorerie Finale</span>
            </a>
          </li>
        </ul>
      </div>
    </aside>

    <!-- Main content -->
    <main class="main-content position-relative border-radius-lg">
      <div class="container-fluid py-4">
        <!-- SECTION ENCAISSEMENTS -->
        <div id="encaissementsSection" class="section-content section-active">
          <div class="row">
            <div class="col-12">
              <div class="card mb-4">
                <div class="card-header pb-0">
                  <h6>Gestion des Encaissements</h6>
                  <button
                    class="btn btn-primary btn-sm ms-2"
                    onclick="openForm()"
                  >
                    + Ajouter Encaissement
                  </button>
                </div>
                <div class="card-body px-0 pt-0 pb-2">
                  <div class="form-group mb-4">
                    <label for="searchInput">Rechercher :</label>
                    <input
                      type="text"
                      class="form-control"
                      id="searchInput"
                      placeholder="Rechercher par ID, Client, Type..."
                      oninput="filterTable()"
                    />
                  </div>
                  <div class="table-responsive p-0">
                    <table
                      class="table align-items-center mb-0"
                      id="encaissementsTable"
                    >
                      <thead>
                        <tr>
                          <th>ID</th>
                          <th>Date</th>
                          <th>Client</th>
                          <th>Type</th>
                          <th>Montant (€)</th>
                          <th>Mode Paiement</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody></tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- SECTION DECAISSEMENTS -->
        <div id="decaissementsSection" class="section-content">
          <div class="card">
            <div class="card-header pb-0">
              <h6>Gestion des Decaissements</h6>
              <p>Ici viendra le contenu de la section decaissements.</p>
            </div>
          </div>
        </div>

        <!-- SECTION TRESORERIE -->
        <div id="tresorerieSection" class="section-content">
          <div class="card">
            <div class="card-header pb-0">
              <h6>Trésorerie Finale</h6>
              <p>Ici viendra le contenu de la section trésorerie finale.</p>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- Modal ajout encaissement -->
    <div
      class="modal fade"
      id="encaissementModal"
      tabindex="-1"
      role="dialog"
      aria-labelledby="encaissementModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="modalTitle">Ajouter Encaissement</h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <div class="form-group">
              <label for="id">ID</label>
              <input class="form-control" id="id" />
            </div>
            <div class="form-group">
              <label for="date">Date</label>
              <input class="form-control" type="date" id="date" />
            </div>
            <div class="form-group">
              <label for="client">Client</label>
              <input class="form-control" id="client" />
            </div>
            <div class="form-group">
              <label for="type">Type</label>
              <select class="form-control" id="type">
                <option>Facture</option>
                <option>Acompte</option>
                <option>Règlement</option>
              </select>
            </div>
            <div class="form-group">
              <label for="montant">Montant (€)</label>
              <input
                class="form-control"
                type="number"
                id="montant"
                step="0.01"
              />
            </div>
            <div class="form-group">
              <label for="mode">Mode Paiement</label>
              <select class="form-control" id="mode">
                <option>Carte</option>
                <option>Virement</option>
                <option>Chèque</option>
                <option>Espèces</option>
              </select>
            </div>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Annuler
            </button>
            <button
              type="button"
              class="btn btn-primary"
              onclick="saveEncaissement()"
            >
              Enregistrer
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- JS -->
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
      function switchSection(sectionId) {
        document.querySelectorAll(".section-content").forEach((el) => {
          el.classList.remove("section-active");
        });
        document
          .getElementById(sectionId + "Section")
          .classList.add("section-active");
      }

      let encaissements = [];
      let currentEditIndex = -1;

      function openForm() {
        const modal = new bootstrap.Modal(
          document.getElementById("encaissementModal")
        );
        modal.show();
        document.getElementById("modalTitle").innerText =
          "Ajouter Encaissement";
        currentEditIndex = -1;
        resetForm();
      }

      function resetForm() {
        document.getElementById("id").value = "";
        document.getElementById("date").value = "";
        document.getElementById("client").value = "";
        document.getElementById("type").value = "Facture";
        document.getElementById("montant").value = "";
        document.getElementById("mode").value = "Carte";
      }

      function saveEncaissement() {
        const encaissement = {
          id: document.getElementById("id").value,
          date: document.getElementById("date").value,
          client: document.getElementById("client").value,
          type: document.getElementById("type").value,
          montant: parseFloat(document.getElementById("montant").value).toFixed(
            2
          ),
          mode: document.getElementById("mode").value,
        };

        if (currentEditIndex === -1) {
          encaissements.push(encaissement);
        } else {
          encaissements[currentEditIndex] = encaissement;
        }
        refreshTable();

        // Fermer le modal
        const modal = bootstrap.Modal.getInstance(
          document.getElementById("encaissementModal")
        );
        modal.hide();
      }

      function editEncaissement(index) {
        currentEditIndex = index;
        const e = encaissements[index];
        document.getElementById("modalTitle").innerText =
          "Modifier Encaissement";
        document.getElementById("id").value = e.id;
        document.getElementById("date").value = e.date;
        document.getElementById("client").value = e.client;
        document.getElementById("type").value = e.type;
        document.getElementById("montant").value = e.montant;
        document.getElementById("mode").value = e.mode;

        const modal = new bootstrap.Modal(
          document.getElementById("encaissementModal")
        );
        modal.show();
      }

      function deleteEncaissement(index) {
        if (confirm("Voulez-vous vraiment supprimer cet encaissement ?")) {
          encaissements.splice(index, 1);
          refreshTable();
        }
      }

      function refreshTable() {
        const tbody = document.querySelector("#encaissementsTable tbody");
        tbody.innerHTML = "";
        encaissements.forEach((e, i) => {
          const row = document.createElement("tr");
          row.innerHTML = `
            <td>${e.id}</td>
            <td>${e.date}</td>
            <td>${e.client}</td>
            <td>${e.type}</td>
            <td>${e.montant}</td>
            <td>${e.mode}</td>
            <td>
              <button class="btn btn-link text-primary" onclick="editEncaissement(${i})"><i class="fas fa-pencil-alt me-2"></i>Modifier</button>
              <button class="btn btn-link text-danger" onclick="deleteEncaissement(${i})"><i class="fas fa-trash-alt me-2"></i>Supprimer</button>
            </td>`;
          tbody.appendChild(row);
        });
      }

      function filterTable() {
        const input = document.getElementById("searchInput");
        const filter = input.value.toLowerCase();
        const table = document.getElementById("encaissementsTable");
        const rows = table.getElementsByTagName("tr");

        for (let i = 1; i < rows.length; i++) {
          const cells = rows[i].getElementsByTagName("td");
          let found = false;
          for (let j = 0; j < cells.length; j++) {
            if (cells[j].innerText.toLowerCase().includes(filter)) {
              found = true;
              break;
            }
          }
          rows[i].style.display = found ? "" : "none";
        }
      }
    </script>
  </body>
</html>
